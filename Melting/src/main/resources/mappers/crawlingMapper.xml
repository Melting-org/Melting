<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.melting.dao.CrawlingDAO">

	<insert id="saveCrawlingData" parameterType="Crawling">
		INSERT INTO m_crawling 
        	(crawlingseq, title, replycnt2, kind, link, membername, likecnt2)
        VALUES 
        	(m_crawling_seq.NEXTVAL, #{title}, #{replycnt2}, #{kind}, #{link}, #{membername}, #{likecnt2})
	</insert>
	
    <delete id="deleteByCreatedAtBefore" parameterType="Date">
        DELETE FROM m_crawling 
        WHERE created_at &lt; #{created_at}
    </delete>
    

	<delete id="deleteOldData" parameterType="int">
	    DELETE FROM m_crawling
		WHERE crawlingseq IN (
		    SELECT crawlingseq
		    FROM (
		      SELECT crawlingseq, ROW_NUMBER() OVER (ORDER BY created_at ASC) AS row_num
		      FROM m_crawling
		    	)
		    WHERE row_num > #{rowLimit}
	   )
	</delete>
</mapper>